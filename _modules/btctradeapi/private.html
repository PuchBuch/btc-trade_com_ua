<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>btctradeapi.private &mdash; btc-trade-api 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="btc-trade-api 0.1.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for btctradeapi.private</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">requests</span>

<span class="kn">from</span> <span class="nn">requestmaker</span> <span class="kn">import</span> <span class="n">RequestMaker</span>
<span class="kn">from</span> <span class="nn">exceptions</span> <span class="kn">import</span> <span class="n">ConnectionError</span><span class="p">,</span> <span class="n">ImpossibleDeal</span><span class="p">,</span> <span class="n">UnknownDeal</span>
<span class="kn">from</span> <span class="nn">decorators</span> <span class="kn">import</span> <span class="n">autoordered</span><span class="p">,</span> <span class="n">dealsfilter</span><span class="p">,</span> <span class="n">checknonce</span>
<span class="kn">from</span> <span class="nn">deals</span> <span class="kn">import</span> <span class="n">DEALS</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">getdeal</span>


<div class="viewcode-block" id="PrivateAPI"><a class="viewcode-back" href="../../index.html#btctradeapi.private.PrivateAPI">[docs]</a><span class="k">class</span> <span class="nc">PrivateAPI</span><span class="p">(</span><span class="n">RequestMaker</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pubkey</span><span class="p">,</span> <span class="n">privkey</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PrivateAPI</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pubkey</span> <span class="o">=</span> <span class="n">pubkey</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">privkey</span> <span class="o">=</span> <span class="n">privkey</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="c1">#TODO: fix multithreading resources race</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nonce</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timespace</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="k">def</span> <span class="nf">makepost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;out_order_id&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">out_order_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nonce&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">nonce</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nonce</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nonce</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_api_url</span><span class="o">+</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">prepare</span><span class="p">()</span>
        <span class="n">req</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;api-sign&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">privkey</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="n">req</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;public-key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pubkey</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timespace</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
            <span class="c1">#import ipdb; ipdb.set_trace()</span>
            <span class="k">print</span> <span class="s2">&quot;url = &#39;</span><span class="si">%s</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">POST body=&#39;</span><span class="si">%s</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">Headers = &#39;</span><span class="si">%s</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">Response: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">e</span>
            <span class="c1">#if response.status_code != 200:</span>
            <span class="kn">import</span> <span class="nn">ipdb</span><span class="p">;</span> <span class="n">ipdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">ConnectionError</span>

<div class="viewcode-block" id="PrivateAPI.auth"><a class="viewcode-back" href="../../index.html#btctradeapi.private.PrivateAPI.auth">[docs]</a>    <span class="k">def</span> <span class="nf">auth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param order: order number</span>
<span class="sd">        :param nonce: nonce number</span>
<span class="sd">        :return:</span>

<span class="sd">        Первый запрос для начала работы с торговым апи должен быть на url :</span>

<span class="sd">            https://btc-trade.com.ua/api/auth</span>

<span class="sd">        С POST параметром out_order_id равным произвольному значению и nonce равный целому произвольному числу.</span>
<span class="sd">        Воспользуемся командой curl :</span>

<span class="sd">        .. code-block:: console</span>

<span class="sd">            $ curl -k -i \\</span>
<span class="sd">            -H &quot;api-sign: 9925916858e6361ffb88fc0b71d763355ea979e3ac62a6acaa8fe4a8ba548abf&quot; \\</span>
<span class="sd">            -H &quot;public-key: 9e6ea26cc7314d6dea8359f8ed5de68b2b5f0ec8daa0d5eac96b86d2b44ada38&quot; \\</span>
<span class="sd">            --data &quot;out_order_id=2&amp;nonce=1&quot; \\</span>
<span class="sd">            -v https://btc-trade.com.ua/api/auth</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">makepost</span><span class="p">(</span><span class="s1">&#39;/auth&#39;</span><span class="p">,</span> <span class="n">out_order_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="n">nonce</span><span class="p">)</span></div>

    <span class="nd">@checknonce</span>
<div class="viewcode-block" id="PrivateAPI.balance"><a class="viewcode-back" href="../../index.html#btctradeapi.private.PrivateAPI.balance">[docs]</a>    <span class="k">def</span> <span class="nf">balance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param order:</span>
<span class="sd">        :param nonce:</span>
<span class="sd">        :return:</span>

<span class="sd">        После старта сессии, первый  запрос, который вам захочеться сделать -</span>
<span class="sd">        это наверняка проверить состояние вашего счета .</span>
<span class="sd">        Для этого необходимо cформировать POST запрос на url:</span>

<span class="sd">            https://btc-trade.com.ua/api/balance</span>

<span class="sd">        С POST параметром out_order_id равным произвольному значению и параметром nonce равный любому целочисленному</span>
<span class="sd">        числу, большем, чем число использованное в предыдущем запросе.</span>
<span class="sd">        Авторизация происходит путем добавление HTTP загаловков public-key и api-sign, где public-key - это публичный</span>
<span class="sd">        ключ из вашего личного кабинета, а api-sign подпись сформированная путем конкатенация вашего post запроса</span>
<span class="sd">        и вашего  private_key, и получением хеш-функции SHA256 от полученной строки.</span>

<span class="sd">        Типовый запрос из командной строки при помощи команды curl :</span>

<span class="sd">        .. code-block:: console</span>

<span class="sd">            $ curl -k   -i \\</span>
<span class="sd">            -H &quot;api-sign: 9925916858e6361ffb88fc0b71d763355ea979e3ac62a6acaa8fe4a8ba548abf&quot; \\</span>
<span class="sd">            -H &quot;public-key: 9e6ea26cc7314d6dea8359f8ed5de68b2b5f0ec8daa0d5eac96b86d2b44ada38&quot; \\</span>
<span class="sd">            --data &quot;out_order_id=2&amp;nonce=1&quot; \\</span>
<span class="sd">            -v  https://btc-trade.com.ua/api/balance</span>

<span class="sd">        Результатом запроса будет :</span>

<span class="sd">        .. code-block:: javascript</span>

<span class="sd">            {</span>
<span class="sd">                &quot;msg_count&quot;: 0,</span>
<span class="sd">                &quot;accounts&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;currency&quot;: &quot;UAH&quot;, &quot;balance&quot;: &quot;1744.2104180000&quot;</span>
<span class="sd">                    }, {</span>
<span class="sd">                        &quot;currency&quot;: &quot;BTC&quot;, &quot;balance&quot;: &quot;0.1205538600&quot;</span>
<span class="sd">                    }, {</span>
<span class="sd">                        &quot;currency&quot;: &quot;LTC&quot;, &quot;balance&quot;: &quot;1.0266850207&quot;</span>
<span class="sd">                    }, {</span>
<span class="sd">                        &quot;currency&quot;: &quot;NVC&quot;, &quot;balance&quot;: &quot;0.0000000000&quot;</span>
<span class="sd">                    }, {</span>
<span class="sd">                        &quot;currency&quot;: &quot;DRK&quot;, &quot;balance&quot;: &quot;0.0000000000&quot;</span>
<span class="sd">                    }, {</span>
<span class="sd">                        &quot;currency&quot;: &quot;VTC&quot;, &quot;balance&quot;: &quot;0.0000000000&quot;</span>
<span class="sd">                    }, {</span>
<span class="sd">                        &quot;currency&quot;: &quot;PPC&quot;, &quot;balance&quot;: &quot;0.0000000000&quot;</span>
<span class="sd">                    }, {</span>
<span class="sd">                        &quot;currency&quot;: &quot;HIRO&quot;, &quot;balance&quot;: &quot;999.5000000000&quot;</span>
<span class="sd">                    }</span>
<span class="sd">                ],</span>
<span class="sd">                &quot;use_f2a&quot;: false,</span>
<span class="sd">                &quot;notify_count&quot;: 0</span>
<span class="sd">            }</span>

<span class="sd">        JSON - объект с полем accounts, содержащим список счетов по каждой ваюте.</span>
<span class="sd">        Внимание! Параметр out_order_id является обязательным и должен быть добавлен  к каждому POST запросу.</span>
<span class="sd">        Желательно его каждый раз изменять.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">makepost</span><span class="p">(</span><span class="s1">&#39;/balance&#39;</span><span class="p">,</span> <span class="n">out_order_id</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="n">nonce</span><span class="p">)</span></div>

    <span class="nd">@checknonce</span>
<div class="viewcode-block" id="PrivateAPI.sell"><a class="viewcode-back" href="../../index.html#btctradeapi.private.PrivateAPI.sell">[docs]</a>    <span class="k">def</span> <span class="nf">sell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currency_from</span><span class="p">,</span> <span class="n">currency_to</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param currency_from:</span>
<span class="sd">        :param currency_to:</span>
<span class="sd">        :param count:</span>
<span class="sd">        :param price:</span>
<span class="sd">        :param order:</span>
<span class="sd">        :param nonce:</span>
<span class="sd">        :return:</span>

<span class="sd">        Для этого необходимо cформировать POST запрос на url по выбранной вами валютной паре в данном случае \</span>
<span class="sd">        LiteCoin/Гривна</span>

<span class="sd">            https://btc-trade.com.ua/api/sell/ltc_uah</span>

<span class="sd">        С POST параметрами:</span>
<span class="sd">            * count: 0.8851641964</span>
<span class="sd">            * price:  55</span>
<span class="sd">            * out_order_id:  55</span>
<span class="sd">            * currency1: UAH</span>
<span class="sd">            * currency: LTC</span>
<span class="sd">            * nonce : 10</span>

<span class="sd">        Где :</span>
<span class="sd">            * nonce - целочисленней инкремент</span>
<span class="sd">            * Count - количество монет для продажи</span>
<span class="sd">            * Price - цена из расчета за одну монету</span>
<span class="sd">            * Currency1 - базовая валюта</span>
<span class="sd">            * Currency - валюта торга</span>
<span class="sd">            * Out_order_id - внешний идентификатор, принимающий произвольное значение</span>

<span class="sd">        И HTTP загаловками :</span>
<span class="sd">            * public-key - публичный ключ</span>
<span class="sd">            * api-sign - хеш сумма SHA256, сформированная от тела POST запроса с добавлением приватного ключа в конце, \</span>
<span class="sd">            например: \</span>

<span class="sd">                count=0.8851641964&amp;nonce=10&amp;price=55&amp;out_order_id=55&amp;currency1=UAH&amp;currency=LTC$privat_key</span>
<span class="sd">                $privat_key - ваш приватный ключ</span>

<span class="sd">        Запрос при помощи команды curl:</span>

<span class="sd">        .. code-block:: console</span>

<span class="sd">            $ curl -k \\</span>
<span class="sd">            -i -H &quot;api-sign: 652167fcdc3d0f55cacd4f2eea27e2f2512669126b2ddf5b5cbdbd8e18c23592&quot; \\</span>
<span class="sd">            -H &quot;public-key: 9e6ea26cc7314d6dea8359f8ed5de68b2b5f0ec8daa0d5eac96b86d2b44ada38&quot;\\</span>
<span class="sd">            --data &quot;currency1=UAH&amp;currency=BTC&amp;count=0.003&amp;price=6200&amp;out_order_id=4&amp;nonce=4&quot; \\</span>
<span class="sd">            -v https://btc-trade.com.ua/api/sell/btc_uah</span>

<span class="sd">        В случае успеха ответом будет JSON объект вида :</span>

<span class="sd">        .. code-block:: javascript</span>

<span class="sd">            {</span>
<span class="sd">                &quot;status&quot;: true,</span>
<span class="sd">                &quot;description&quot;: &quot;The order has been created&quot;,</span>
<span class="sd">                &quot;oder_id&quot;: 1</span>
<span class="sd">            }</span>

<span class="sd">        * order_id - будет содержать внутренний идентификатор в системе, \</span>
<span class="sd">         по которому можно будет проверить состояние вашей заявки</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">deal</span> <span class="o">=</span> <span class="n">getdeal</span><span class="p">(</span><span class="n">currency_to</span><span class="p">,</span> <span class="n">currency_from</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">deal</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ImpossibleDeal</span><span class="p">()</span>
        <span class="c1">#time.sleep(self.timespace)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">makepost</span><span class="p">(</span><span class="s1">&#39;/sell/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">deal</span><span class="p">,</span> <span class="n">currency1</span><span class="o">=</span><span class="n">currency_from</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="n">currency_to</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="n">price</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="n">out_order_id</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="n">nonce</span><span class="p">)</span></div>

    <span class="nd">@checknonce</span>
<div class="viewcode-block" id="PrivateAPI.buy"><a class="viewcode-back" href="../../index.html#btctradeapi.private.PrivateAPI.buy">[docs]</a>    <span class="k">def</span> <span class="nf">buy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currency_from</span><span class="p">,</span> <span class="n">currency_to</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param currency_from:</span>
<span class="sd">        :param currency_to:</span>
<span class="sd">        :param count:</span>
<span class="sd">        :param price:</span>
<span class="sd">        :param order:</span>
<span class="sd">        :param nonce:</span>
<span class="sd">        :return:</span>

<span class="sd">        Заявка покупки формируется подобным образом, только на другой  url, для пары LiteCoin/Гривна:</span>

<span class="sd">            https://btc-trade.com.ua/api/buy/ltc_uah</span>

<span class="sd">        С POST параметрами</span>
<span class="sd">            * count: 0.8851641964</span>
<span class="sd">            * price:  55</span>
<span class="sd">            * out_order_id:  57</span>
<span class="sd">            * currency1: UAH</span>
<span class="sd">            * currency: LTC</span>
<span class="sd">            * nonce: 11</span>

<span class="sd">        Где :</span>
<span class="sd">            * nonce - целочисленней инкремент</span>
<span class="sd">            * Count - количество монет для покупки</span>
<span class="sd">            * Price - цена из расчета за одну монету</span>
<span class="sd">            * Currency1 - базовая валюта</span>
<span class="sd">            * Currency - валюта торга</span>
<span class="sd">            * Out_order_id - внешний идентификатор, принимающий произвольное значение</span>

<span class="sd">        И HTTP загаловками :</span>
<span class="sd">            * public-key - публичный ключ</span>
<span class="sd">            * api-sign - хеш сумма SHA256, сформированная от тела POST запроса с добавлением приватного ключа в конце, \</span>
<span class="sd">            например:</span>

<span class="sd">                count=0.8851641964&amp;price=55&amp;nonce=11&amp;out_order_id=55&amp;currency1=UAH&amp;currency=LTC$privat_key</span>

<span class="sd">                $privat_key - ваш публичный ключ</span>

<span class="sd">        В случае успеха ответом будет JSON объект вида :</span>

<span class="sd">        .. code-block:: javascript</span>

<span class="sd">            {</span>
<span class="sd">                &quot;status&quot;: true,</span>
<span class="sd">                &quot;description&quot;: &quot;The order has been created&quot;,</span>
<span class="sd">                &quot;oder_id&quot;: 1</span>
<span class="sd">            }</span>

<span class="sd">        * order_id - будет содержать внутренний идентификатор в системе, \</span>
<span class="sd">        по которому можно будет проверить состояние вашей заявки</span>

<span class="sd">        Сразу же после выполнения заявки, начинается поиск обратного предложения для нее. \</span>
<span class="sd">        Если система находит предложение удовлетворяющее вашим условиям - система проводит сделку купли/продажи.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">deal</span> <span class="o">=</span> <span class="n">getdeal</span><span class="p">(</span><span class="n">currency_from</span><span class="p">,</span> <span class="n">currency_to</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">deal</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ImpossibleDeal</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">order</span><span class="p">:</span>
            <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span>
        <span class="c1">#time.sleep(self.timespace)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">makepost</span><span class="p">(</span><span class="s1">&#39;/buy/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">deal</span><span class="p">,</span> <span class="n">currency1</span><span class="o">=</span><span class="n">currency_from</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="n">currency_to</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="n">price</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="n">out_order_id</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="n">nonce</span><span class="p">)</span></div>

    <span class="nd">@dealsfilter</span>
    <span class="nd">@checknonce</span>
<div class="viewcode-block" id="PrivateAPI.opened_orders"><a class="viewcode-back" href="../../index.html#btctradeapi.private.PrivateAPI.opened_orders">[docs]</a>    <span class="k">def</span> <span class="nf">opened_orders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deal</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param deal:</span>
<span class="sd">        :param order:</span>
<span class="sd">        :param nonce:</span>
<span class="sd">        :return:</span>

<span class="sd">        Получение списка открытых заявок</span>

<span class="sd">        Для провеки статуса выполнения заявок необходимо сформировать запрос на url, в данном случае по валютной паре BTC/UAH :</span>

<span class="sd">            https://btc-trade.com.ua/api/my_orders/btc_uah</span>

<span class="sd">        С POST параметрами</span>
<span class="sd">            * out_order_id:  58</span>
<span class="sd">            * nonce: 12</span>

<span class="sd">        Где :</span>
<span class="sd">            * nonce - целочисленней инкремент</span>
<span class="sd">            * Out_order_id - внешний идентификатор, принимающий произвольное значение</span>

<span class="sd">        И HTTP загаловками :</span>
<span class="sd">            * api-sign - хеш сумма SHA256, сформированная от тела POST запроса с добавлением приватного ключа в конце, \</span>
<span class="sd">            например:</span>

<span class="sd">                out_order_id=58&amp;nonce=12$privat_key</span>

<span class="sd">                $privat_key - ваш приватный  ключ</span>

<span class="sd">            * public-key - публичный ключ</span>

<span class="sd">         В случае успеха ответом будет JSON объект вида :</span>

<span class="sd">         .. code-block: javascript</span>

<span class="sd">                {</span>
<span class="sd">                    &quot;your_open_orders&quot;: [</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;amnt_base&quot;: &quot;1538.2358440000&quot;,</span>
<span class="sd">                            &quot;pub_date&quot;: &quot;Oct. 18, 2014, 7:40 p.m.&quot;,</span>
<span class="sd">                            &quot;price&quot;: &quot;5400.0000000000&quot;,</span>
<span class="sd">                            &quot;sum2&quot;: &quot;1538.2358440000&quot;,</span>
<span class="sd">                            &quot;sum1&quot;: &quot;0.2848584896&quot;,</span>
<span class="sd">                            &quot;amnt_trade&quot;: &quot;0.2848584896&quot;,</span>
<span class="sd">                            &quot;type&quot;: &quot;sell&quot;,</span>
<span class="sd">                            &quot;id&quot;: 4624</span>
<span class="sd">                        },</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;amnt_base&quot;: &quot;1159.4200000000&quot;, &quot;pub_date&quot;: &quot;Oct. 14, 2014, 8:57 p.m.&quot;,</span>
<span class="sd">                            &quot;price&quot;: &quot;5800.0000000000&quot;, &quot;sum2&quot;: &quot;1159.4200000000&quot;, &quot;sum1&quot;: &quot;0.1999000000&quot;,</span>
<span class="sd">                            &quot;amnt_trade&quot;: &quot;0.1999000000&quot;, &quot;type&quot;: &quot;sell&quot;, &quot;id&quot;: 4405</span>
<span class="sd">                        }, {</span>
<span class="sd">                            &quot;amnt_base&quot;: &quot;1258.3137610000&quot;, &quot;pub_date&quot;: &quot;Oct. 10, 2014, 9:18 p.m.&quot;,</span>
<span class="sd">                            &quot;price&quot;: &quot;6200.0000000000&quot;, &quot;sum2&quot;: &quot;1258.3137610000&quot;, &quot;sum1&quot;: &quot;0.2029538324&quot;,</span>
<span class="sd">                            &quot;amnt_trade&quot;: &quot;0.2029538324&quot;, &quot;type&quot;: &quot;sell&quot;, &quot;id&quot;: 4052</span>
<span class="sd">                        }</span>
<span class="sd">                    ],</span>
<span class="sd">                    &quot;balance_buy&quot;: &quot;0.0000396100&quot;,</span>
<span class="sd">                    &quot;auth&quot;: true,</span>
<span class="sd">                    &quot;balance_sell&quot;: &quot;0.0000000000&quot;</span>
<span class="sd">                }</span>

<span class="sd">        Поле your_open_orders содержит  список ваших открытых заявок на покупку/продажу.</span>

<span class="sd">            * id - идентификатор заявки</span>
<span class="sd">            * type - типа</span>
<span class="sd">                * покупка - buy</span>
<span class="sd">                * продажа - sell</span>
<span class="sd">            * amnt_trade - сумма в валюте торга</span>
<span class="sd">            * amnt_base - сумма в базовой валюте</span>
<span class="sd">            * price - цена из расчета за одну единицу валюты торга</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">makepost</span><span class="p">(</span><span class="s1">&#39;/my_orders/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">deal</span><span class="p">,</span> <span class="n">out_order_id</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="n">nonce</span><span class="p">)</span></div>

    <span class="nd">@checknonce</span>
<div class="viewcode-block" id="PrivateAPI.order_status"><a class="viewcode-back" href="../../index.html#btctradeapi.private.PrivateAPI.order_status">[docs]</a>    <span class="k">def</span> <span class="nf">order_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order_id</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param order_id:</span>
<span class="sd">        :param order:</span>
<span class="sd">        :param nonce:</span>
<span class="sd">        :return:</span>

<span class="sd">        Проверка статуса выполнения  заявки</span>

<span class="sd">        Для провеки статуса выполнения заявок необходимо сформировать запрос на url:</span>

<span class="sd">            https://btc-trade.com.ua/api/order/status/$id</span>

<span class="sd">        С POST параметрами</span>
<span class="sd">            * out_order_id:  59</span>
<span class="sd">            * nonce: 13</span>

<span class="sd">        Где :</span>
<span class="sd">            * nonce - целочисленней инкремент</span>
<span class="sd">            * out_order_id - внешний идентификатор, принимающий произвольное значение</span>
<span class="sd">            * $id - идентификатор полученный при создании заявки</span>

<span class="sd">        И HTTP загаловками :</span>
<span class="sd">            * public-key - публичный ключ</span>
<span class="sd">            * api-sign - хеш сумма SHA256, сформированная от тела POST запроса с добавлением приватного ключа в конце, \</span>
<span class="sd">            например:</span>

<span class="sd">                nonce=13&amp;out_order_id=58$privat_key</span>

<span class="sd">                $privat_key - ваш  приватный  ключ</span>

<span class="sd">        В случае успеха ответом будет JSON объект вида :</span>

<span class="sd">        .. code-block: javascript</span>

<span class="sd">            {</span>
<span class="sd">                &quot;status&quot;: &quot;processing&quot;,</span>
<span class="sd">                &quot;sum2_history&quot;: &quot;1538.2358440000&quot;,</span>
<span class="sd">                &quot;currency1&quot;: &quot;BTC&quot;,</span>
<span class="sd">                &quot;sum2&quot;: &quot;1538.2358440000&quot;,</span>
<span class="sd">                &quot;sum1&quot;: &quot;0.2848584896&quot;,</span>
<span class="sd">                &quot;currency2&quot;: &quot;BTC&quot;,</span>
<span class="sd">                &quot;sum1_history&quot;: &quot;0.2848584896&quot;,</span>
<span class="sd">                &quot;pub_date&quot;: &quot;2014-10-18 19:40:20&quot;,</span>
<span class="sd">                &quot;id&quot;: &quot;4624&quot;</span>
<span class="sd">            }</span>

<span class="sd">        * status - принимает значение</span>
<span class="sd">            * processing - в работе,</span>
<span class="sd">            * processed - выполнена,</span>
<span class="sd">            * canceled - отменена</span>
<span class="sd">        * sum1_history - заявочная сумма продажи</span>
<span class="sd">        * sum2_history - заявочная сумма покупки</span>
<span class="sd">        * sum1 - оставшаяся сумма продажи</span>
<span class="sd">        * sum2 - оставшаяся сумма продажи</span>
<span class="sd">        * currency1 - валюта продажи</span>
<span class="sd">        * currency2 - валюта покупки</span>
<span class="sd">        * id - идентификатор заявки</span>
<span class="sd">        * pub_date - дата заявки</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">makepost</span><span class="p">(</span><span class="s1">&#39;/order/status/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">order_id</span><span class="p">,</span> <span class="n">out_order_id</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="n">nonce</span><span class="p">)</span></div>

    <span class="nd">@checknonce</span>
<div class="viewcode-block" id="PrivateAPI.remove_order"><a class="viewcode-back" href="../../index.html#btctradeapi.private.PrivateAPI.remove_order">[docs]</a>    <span class="k">def</span> <span class="nf">remove_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order_id</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param self:</span>
<span class="sd">        :param order_id:</span>
<span class="sd">        :param order:</span>
<span class="sd">        :param nonce:</span>
<span class="sd">        :return:</span>

<span class="sd">        Удаление  заявки:</span>

<span class="sd">        Для провеки статуса выполнения заявок необходимо сформировать запрос на url:</span>

<span class="sd">            https://btc-trade.com.ua/api/order/remove/$id</span>

<span class="sd">        С POST параметрами</span>
<span class="sd">            * out_order_id:  90</span>
<span class="sd">            * nonce: 14</span>

<span class="sd">        Где :</span>
<span class="sd">            * Out_order_id - внешний идентификатор, принимающий произвольное значение</span>
<span class="sd">            * $id - идентификатор полученный при создании заявки</span>

<span class="sd">        И HTTP загаловками :</span>
<span class="sd">            * public-key - публичный ключ</span>
<span class="sd">            * api-sign - хеш сумма SHA256, сформированная от тела POST запроса с добавлением приватного ключа в конце, \</span>
<span class="sd">            например:</span>

<span class="sd">                nonce=14&amp;out_order_id=90$privat_key</span>

<span class="sd">                $privat_key - ваш приватный ключ</span>

<span class="sd">         В случае успеха ответом будет JSON объект вида :</span>

<span class="sd">         .. code-block:: javascript</span>

<span class="sd">            {</span>
<span class="sd">                &quot;status&quot;: true</span>
<span class="sd">            }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">makepost</span><span class="p">(</span><span class="s1">&#39;/order/remove/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">order_id</span><span class="p">,</span> <span class="n">out_order_id</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="n">nonce</span><span class="p">)</span></div>

    <span class="nd">@dealsfilter</span>
    <span class="nd">@checknonce</span>
<div class="viewcode-block" id="PrivateAPI.get_cost_of_buying"><a class="viewcode-back" href="../../index.html#btctradeapi.private.PrivateAPI.get_cost_of_buying">[docs]</a>    <span class="k">def</span> <span class="nf">get_cost_of_buying</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deal</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param deal:</span>
<span class="sd">        :param amount:</span>
<span class="sd">        :param order:</span>
<span class="sd">        :param nonce:</span>
<span class="sd">        :return:</span>

<span class="sd">        Получение стоимости покупки 1 коина</span>

<span class="sd">        Этот поможет узнать сколько будет стоить покупка одного коина в базовой валюте.</span>
<span class="sd">        Возьмем для примера bitcoin</span>

<span class="sd">            https://btc-trade.com.ua/api/ask/btc_uah</span>

<span class="sd">        С POST параметрами</span>
<span class="sd">            * out_order_id:  59</span>
<span class="sd">            * amount:1.01</span>
<span class="sd">            * nonce: 17</span>

<span class="sd">        Где :</span>
<span class="sd">            * nonce - целочисленней инкремент</span>
<span class="sd">            * Out_order_id - внешний идентификатор, принимающий произвольное значение</span>
<span class="sd">            * Amount - количество монет желаемой покупки</span>

<span class="sd">        И HTTP загаловками :</span>
<span class="sd">            * public-key - публичный ключ</span>
<span class="sd">            * api-sign - хеш сумма SHA256, сформированная от тела POST запроса с добавлением приватного ключа в конце, \</span>
<span class="sd">            например :</span>

<span class="sd">                nonce=17&amp;out_order_id=58&amp;amount=1.01$privat_key</span>

<span class="sd">                $privat_key - ваш приватный ключ</span>

<span class="sd">         В случае успеха ответом будет JSON объект вида :</span>

<span class="sd">         .. code-block:: javascript</span>

<span class="sd">            {</span>
<span class="sd">                &quot;status&quot;: true,</span>
<span class="sd">                &quot;avarage_price&quot;: &quot;6500.0000000000&quot;,</span>
<span class="sd">                &quot;min_price&quot;: &quot;6500.0000000000&quot;,</span>
<span class="sd">                &quot;buy_sum&quot;: &quot;1.0000000000&quot;,</span>
<span class="sd">                &quot;max_price&quot;: &quot;6500.0000000000&quot;,</span>
<span class="sd">                &quot;amount2pay&quot;: &quot;6500.0000000000&quot;</span>
<span class="sd">            }</span>

<span class="sd">        * status - результат запроса true или false</span>
<span class="sd">        * avarage_price - средняя цена покупки</span>
<span class="sd">        * min_price - минимальная цена в выборке</span>
<span class="sd">        * max_price - максимальная цена в выборке</span>
<span class="sd">        * amount2pay - сумма к оплате в базовой валюте</span>
<span class="sd">        * buy_sum - сумма покупки</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">makepost</span><span class="p">(</span><span class="s1">&#39;/ask/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">deal</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">,</span> <span class="n">out_order_id</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="n">nonce</span><span class="p">)</span></div>

    <span class="nd">@dealsfilter</span>
    <span class="nd">@checknonce</span>
<div class="viewcode-block" id="PrivateAPI.get_cost_of_selling"><a class="viewcode-back" href="../../index.html#btctradeapi.private.PrivateAPI.get_cost_of_selling">[docs]</a>    <span class="k">def</span> <span class="nf">get_cost_of_selling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deal</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param deal:</span>
<span class="sd">        :param amount:</span>
<span class="sd">        :param order:</span>
<span class="sd">        :param nonce:</span>
<span class="sd">        :return:</span>

<span class="sd">        Получение стоимости продажи 1 коина</span>

<span class="sd">        Этот поможет узнать сколько будет стоить продажа одного коина в базовой валюте.</span>
<span class="sd">        Возьмем для примера bitcoin:</span>

<span class="sd">            https://btc-trade.com.ua/api/bid/btc_uah</span>

<span class="sd">        С POST параметрами</span>
<span class="sd">        * out_order_id:  59</span>
<span class="sd">        * amount:1.01</span>
<span class="sd">        * nonce: 18</span>

<span class="sd">        Где :</span>
<span class="sd">            * nonce - целочисленней инкремент</span>
<span class="sd">            * Out_order_id - внешний идентификатор, принимающий произвольное значение</span>
<span class="sd">            * Amount - количество монет желаемой продажи</span>

<span class="sd">        И HTTP загаловками :</span>
<span class="sd">            * public-key - публичный ключ</span>
<span class="sd">            * api-sign - хеш сумма SHA256, сформированная от тела POST запроса с добавлением приватного ключа в конце, \</span>
<span class="sd">            например  :</span>

<span class="sd">                out_order_id=58&amp;amount=1.01&amp;nonce=18$privat_key</span>

<span class="sd">                $privat_key - ваш приватный ключ</span>

<span class="sd">         В случае успеха ответом будет JSON объект вида :</span>

<span class="sd">         .. code-block:: javascript</span>

<span class="sd">            {</span>
<span class="sd">                &quot;status&quot;: true,</span>
<span class="sd">                &quot;avarage_price&quot;: &quot;6300.0000000000&quot;,</span>
<span class="sd">                &quot;min_price&quot;: &quot;6300.0000000000&quot;,</span>
<span class="sd">                &quot;buy_sum&quot;: &quot;6300.0000000000&quot;,</span>
<span class="sd">                &quot;max_price&quot;: &quot;6300.0000000000&quot;,</span>
<span class="sd">                &quot;amount2pay&quot;: &quot;1.0000000000&quot;</span>
<span class="sd">            }</span>

<span class="sd">        * status - результат запроса true или false</span>
<span class="sd">        * avarage_price - средняя цена продажи из расчета за одну монету</span>
<span class="sd">        * min_price - минимальная цена в выборке заявок</span>
<span class="sd">        * max_price - максимальная цена в выборке заявок</span>
<span class="sd">        * amount2pay - сумма продажи в  валюте торга</span>
<span class="sd">        * buy_sum - сумма вырученная за сделку</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">makepost</span><span class="p">(</span><span class="s1">&#39;/bid/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">deal</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">,</span> <span class="n">out_order_id</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">nonce</span><span class="o">=</span><span class="n">nonce</span><span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Andrew Vasyltsiv(kostyll).
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
    </div>

    

    
  </body>
</html>